差分数组是一种用于高效**<u>处理数组区间更新和查询</u>**的辅助数据结构，尤其在需要对数组的多个连续区间进行增减操作时，能显著降低时间复杂度。

### **一、差分数组的定义**

假设有一个原始数组 `arr`（长度为 `n`），其对应的差分数组 `diff` 定义为：

- `diff[0] = arr[0]`
- 对于 `i > 0`，`diff[i] = arr[i] - arr[i-1]`

简单来说，差分数组的每个元素 `diff[i]` 表示原始数组中当前元素与前一个元素的差值。

### **二、差分数组的核心作用**

通过差分数组，可以将**对原始数组的区间更新操作**转化为**对差分数组的单点更新操作**，最后再通过差分数组还原出更新后的原始数组。

#### 具体操作逻辑：

1. **区间更新**：
    若要对原始数组 `arr` 的区间 `[l, r]` 内的所有元素都加上一个值 `k`，只需在差分数组 `diff` 中做以下操作：

    - `diff[l] += k`（表示从 `l` 开始，元素值增加 `k`）
    - 若 `r+1 < n`，则 `diff[r+1] -= k`（表示从 `r+1` 开始，元素值停止增加 `k`，抵消前面的操作）
2. **还原原始数组**：
    对更新后的差分数组 `diff` 求**前缀和**，即可得到更新后的原始数组 `arr`：

    - `arr[0] = diff[0]`
    - 对于 `i > 0`，`arr[i] = arr[i-1] + diff[i]`

### **三、示例说明**

假设原始数组 `arr = [1, 3, 5, 7, 9]`，差分数组 `diff` 的计算如下：

- `diff[0] = 1`
- `diff[1] = 3 - 1 = 2`
- `diff[2] = 5 - 3 = 2`
- `diff[3] = 7 - 5 = 2`
- `diff[4] = 9 - 7 = 2`

即 `diff = [1, 2, 2, 2, 2]`。

#### 场景：对区间 `[1, 3]` 的元素都加 `4`

1. 差分数组更新：

    - `l=1`，`diff[1] += 4` → `diff[1] = 6`
    - `r=3`，`r+1=4 < 5`，`diff[4] -=4` → `diff[4] = -2`
      此时 `diff` 变为 `[1, 6, 2, 2, -2]`。
2. 还原原始数组（求前缀和）：

    - `arr[0] = 1`
    - `arr[1] = 1 + 6 = 7`
    - `arr[2] = 7 + 2 = 9`
    - `arr[3] = 9 + 2 = 11`
    - `arr[4] = 11 + (-2) = 9`
      得到更新后的 `arr = [1, 7, 9, 11, 9]`，符合预期（区间 `[1,3]` 各元素加了 `4`）。

### **四、优势与适用场景**

- **时间复杂度优化**：
  传统的区间更新需要 `O(r-l+1)` 的时间，而通过差分数组只需 `O(1)`，最后还原数组为 `O(n)`，适合多次区间更新的场景（如频繁增减操作）。
- **适用场景**：

  - 数组区间增减（如统计区间内的数值变化）
  - 日程安排问题（如多个时间段的重叠统计）
  - 前缀和相关的衍生问题

### **总结**

差分数组是原始数组相邻元素差值的集合，通过它可以将复杂的区间更新转化为简单的单点操作，大幅提升效率。核心步骤是“区间更新转差分数组单点更新 → 前缀和还原原始数组”。