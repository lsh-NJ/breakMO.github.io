**树状数组**（Binary Indexed Tree，BIT），也被叫做 Fenwick Tree，是一种能够**高效处理区间查询与单点更新问题的数据结构**。其核心原理是**借助二进制的特性，把数组元素的前缀和信息存储在树状结构里，从而让查询和更新操作的时间复杂度都达到 O(log n)。** 

### 核心思想

树状数组的基本思想是：对于任意整数 x，它的**二进制表示里最低位的 1 所在的位置决定了该节点所管辖的范围大小**。举个例子，若 x 的二进制是 10100（也就是十进制的 20），其最低位的 1 在第 2 位（从右往左数，从 0 开始计数），那么该节点就**管辖从 x - 2² + 1 到 x 这个范围的元素和**。

### 核心操作

1. **lowbit 函数**：此函数用于计算 x 的最低位 1 所代表的数值，在代码里一般表示为 `x & -x`。例如：

    * 当 x 为 6（二进制是 110）时，`lowbit(6)` 的结果是 2（二进制为 10）。
    * 当 x 为 8（二进制是 1000）时，`lowbit(8)` 的结果是 8（二进制为 1000）。
2. **单点更新**：在更新原数组的某个元素时，需要同时更新树状数组中所有包含该元素的节点。更新的方法是从当前节点开始，不断加上 `lowbit(x)`，直到超出数组的范围。
3. **前缀和查询**：要计算原数组从下标 1 到 x 的前缀和，需要从当前节点 x 开始，不断减去 `lowbit(x)`，并累加经过的节点值，直到 x 变为 0。

### 代码实现

下面是树状数组的基本实现：

```c
#include <stdio.h>
#define MAXN 1000

int fen[MAXN + 5];  // 树状数组，下标从 1 开始
int n;  // 数组的大小

// 更新操作：将下标为 x 的元素增加 val
void update(int x, int val) {
    while (x <= n) {
        fen[x] += val;
        x += x & -x;  // 找到父节点
    }
}

// 查询操作：计算从 1 到 x 的前缀和
int query(int x) {
    int res = 0;
    while (x > 0) {
        res += fen[x];
        x -= x & -x;  // 找到上一个区间
    }
    return res;
}

// 初始化树状数组
void init() {
    for (int i = 1; i <= n; i++) {
        fen[i] = 0;
    }
}

// 区间查询：计算区间 [l, r] 的和
int range_query(int l, int r) {
    return query(r) - query(l - 1);
}

int main() {
    // 示例：初始化数组大小
    n = 5;
    
    // 初始化树状数组
    init();
    
    // 更新操作：a[1] = 3, a[2] = 4, a[3] = 2, a[4] = 5, a[5] = 1
    update(1, 3);
    update(2, 4);
    update(3, 2);
    update(4, 5);
    update(5, 1);
    
    // 查询操作
    printf("前缀和 S(3) = %d\n", query(3));  // 输出 9 (3 + 4 + 2)
    printf("区间和 S[2, 4] = %d\n", range_query(2, 4));  // 输出 11 (4 + 2 + 5)
    
    // 更新操作：a[3] += 3
    update(3, 3);
    
    // 再次查询
    printf("前缀和 S(3) = %d\n", query(3));  // 输出 12 (3 + 4 + 5)
    
    return 0;
}
```

### 应用场景

* **单点更新与区间查询**：这是树状数组最基本的应用场景，能够高效地处理动态数据的前缀和查询。
* **区间更新与单点查询**：通过差分的方式，可以将区间更新问题转化为单点更新问题。
* **区间更新与区间查询**：结合差分和树状数组的扩展，可以实现区间更新和区间查询。
* **逆序对统计**：在统计数组逆序对的数量时，树状数组是一种高效的数据结构。

树状数组的优势在于实现简单、空间效率高，不过它只能处理前缀和查询。要是需要处理更复杂的区间查询（像区间最大值、最小值等），可以考虑使用线段树。

### 扩展项目：

* [ ] 差分和树状数组扩展
* [ ] 线段树